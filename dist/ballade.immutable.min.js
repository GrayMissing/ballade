!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var t;t="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,t.Ballade=e()}}(function(){return function e(t,n,r){function o(s,a){if(!n[s]){if(!t[s]){var u="function"==typeof require&&require;if(!a&&u)return u(s,!0);if(i)return i(s,!0);var c=new Error("Cannot find module '"+s+"'");throw c.code="MODULE_NOT_FOUND",c}var l=n[s]={exports:{}};t[s][0].call(l.exports,function(e){var n=t[s][1][e];return o(n?n:e)},l,l.exports,e,t,n,r)}return n[s].exports}for(var i="function"==typeof require&&require,s=0;s<r.length;s++)o(r[s]);return o}({1:[function(e,t,n){},{}],2:[function(e,t,n){"use strict";var r=e("./queue"),o=e("./mutable-store"),i=e("./immutable-store"),s={version:"0.2.1"},a=function(){this.actionTypes={},this.storeQueue=[],this.id=Date.now()+Math.round(1e3*Math.random()),this.middlewareQueue=new r(function(e){this.__invokeCallback__(e)}.bind(this),!0)};a.prototype={__invokeCallback__:function(e){this.storeQueue.forEach(function(t){var n,r,o=t.callbacks[e.type];"function"==typeof o&&(n=o(t.store,e),void 0!==n&&(t.mutable?void 0!==n&&t.store.event.publish(n):n!==t.store.immutable&&(t.store.immutable.forEach(function(e,t){e!==n.get(t)&&(r=t)}),t.store.immutable=n,t.store.event.publish(r))))})},use:function(e){"function"==typeof e&&this.middlewareQueue.enter(e)},__dispatch__:function(e,t){var n,r=t(),o=this.actionTypes,i=r.type;if(!i)throw new Error("action type does not exist in \n"+JSON.stringify(r,null,2));if(n=o[i]){if(n!==e)throw new Error('action type "'+i+'" is duplicate')}else o[i]=e;this.middlewareQueue.execute(r)},createActions:function(e){var t,n,r=(this.id++).toString(32),o=this,i={};for(t in e)n=e[t],i[t]=function(e,t){return function(){var n=arguments;o.__dispatch__(t,function(){return e.apply(null,Array.prototype.slice.call(n))})}}(n,r);return i},createMutableStore:function(e,t){if(!t)throw new Error("schema must in createMutableStore arguments");var n=new o(e),r={mutable:{},event:{}};return r.mutable.get=n.mutable.get.bind(n.mutable),r.event.subscribe=n.event.subscribe.bind(n.event),r.event.unsubscribe=n.event.unsubscribe.bind(n.event),this.storeQueue.push({mutable:!0,store:n,callbacks:t}),r},createImmutableStore:function(e,t){if(!t)throw new Error("schema must in createImmutableStore arguments");var n=new i(e);return this.storeQueue.push({mutable:!1,store:n,callbacks:t}),n}},s.Dispatcher=a,t.exports=s},{"./immutable-store":5,"./mutable-store":6,"./queue":7}],3:[function(e,t,n){function r(e,t,n){if(!(e instanceof Object))return e;var o,i=Object.prototype.toString.call(e).slice(8,-1);switch(i){case"Array":o=[];break;case"Date":o=new Date(e.getTime());break;case"RegExp":o=new RegExp(e);break;case"Function":break;case"Uint8Array":case"Uint8ClampedArray":case"Uint16Array":case"Uint32Array":case"Int8Array":case"Int16Array":case"Int32Array":case"Float32Array":case"Float64Array":o=e.subarray();break;default:o={}}if(t.push(e),n.push(o),e instanceof Array)for(var s=0;s<e.length;s++)o[s]=r(e[s],t,n);for(var a=Object.keys(e).sort(),u=Object.keys(o).sort(),c=0;c<a.length;c++){var l=a[c];if(u.length>0&&l===u[0])u.shift();else if(Object.prototype.hasOwnProperty.call(e,l)){var f=e[l],h=t.indexOf(f);o[l]=-1!==h?n[h]:r(e[l],t,n)}}return o}t.exports=function(e){return r(e,[],[])}},{}],4:[function(e,t,n){"use strict";var r=function(){this.handlers=[]};r.prototype={publish:function(e){this.handlers.forEach(function(t){t.type?t.type===e&&t.handler(e):t.handler(e)})},subscribe:function(e,t){var n={};"function"==typeof e?n.handler=e:(n.handler=t,n.type=e),this.handlers.push(n)},unsubscribe:function(e,t){"function"==typeof e&&(t=e,e=null);for(var n,r=0;r<this.handlers.length;r++)n=this.handlers[r],(!n.type&&n.handeler===t||e&&t&&n.type===e&&n.handler===t||e&&n.type===e||t&&n.handler===t)&&this.handlers.splice(r--,1)}},t.exports=r},{}],5:[function(e,t,n){"use strict";var r,o=e("./event");r="undefined"!=typeof self&&self.Immutable?self.Immutable:"undefined"!=typeof global&&global.Immutable?global.Immutable:e("immutable");var i=function(e){return Object.prototype.toString.call(e).slice(8,-1)},s=function(e){Object.keys(e).forEach(function(t){var n=e[t],o=i(n);("Array"===o||"Object"===o)&&(e[t]=r.fromJS(n))}),this.immutable=new(r.Record(e)),this.event=new o};t.exports=s},{"./event":4,immutable:1}],6:[function(e,t,n){"use strict";var r=e("./copy"),o=e("./event"),i={string:!0,number:!0,"null":!0,undefind:!0,"boolean":!0},s=function(e){this.store={},Object.keys(e).forEach(function(t){this.store[t]=e[t]}.bind(this))};s.prototype={set:function(e,t){return e in this.store?(this.store[e]=t,e):void 0},get:function(e){var t=this.store[e],n=typeof t;return i[n]?t:r(t)},"delete":function(e){return delete this.store[e],e}};var a=function(e){this.mutable=new s(e),this.event=new o};t.exports=a},{"./copy":3,"./event":4}],7:[function(e,t,n){"use strict";var r=function(e,t){this.workflows=[],this.completeCallback=e,t&&(this._workflows=[])};r.prototype={enter:function(e){this.workflows.push(e),this._workflows&&this._workflows.push(e)},execute:function(e,t){t=t||this.workflows.concat();var n;t.length?(n=t.shift())(e,this.execute.bind(this,e,t)):(this._workflows&&(this.workflows=this._workflows.concat()),t=null,this.completeCallback(e))}},t.exports=r},{}]},{},[2])(2)});