!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var t;t="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,t.Ballade=e()}}(function(){return function e(t,n,r){function i(s,a){if(!n[s]){if(!t[s]){var u="function"==typeof require&&require;if(!a&&u)return u(s,!0);if(o)return o(s,!0);var c=new Error("Cannot find module '"+s+"'");throw c.code="MODULE_NOT_FOUND",c}var f=n[s]={exports:{}};t[s][0].call(f.exports,function(e){var n=t[s][1][e];return i(n?n:e)},f,f.exports,e,t,n,r)}return n[s].exports}for(var o="function"==typeof require&&require,s=0;s<r.length;s++)i(r[s]);return i}({1:[function(e,t,n){"use strict";var r=e("./queue"),i=e("./mutable-store"),o={version:"0.2.2"},s=function(){this.actionTypes={},this.storeQueue=[],this.id=Date.now()+Math.round(1e3*Math.random()),this.middlewareQueue=new r(function(e){this.__invokeCallback__(e)}.bind(this),!0)};s.prototype={__invokeCallback__:function(e){this.storeQueue.forEach(function(t){var n,r=t.callbacks[e.type];"function"==typeof r&&(n=r(t.store,e),void 0!==n&&t.store.event.publish(n))})},use:function(e){"function"==typeof e&&this.middlewareQueue.enter(e)},__dispatch__:function(e,t){var n,r=t(),i=this.actionTypes,o=r.type;if(!o)throw new Error("action type does not exist in \n"+JSON.stringify(r,null,2));if(n=i[o]){if(n!==e)throw new Error('action type "'+o+'" is duplicate')}else i[o]=e;this.middlewareQueue.execute(r)},createActions:function(e){var t,n,r=(this.id++).toString(32),i=this,o={};for(t in e)n=e[t],o[t]=function(e,t){return function(){var n=arguments;i.__dispatch__(t,function(){return e.apply(null,Array.prototype.slice.call(n))})}}(n,r);return o},createMutableStore:function(e,t){if(!t)throw new Error("schema must in createMutableStore arguments");var n=new i(e),r={mutable:{},event:{}};return r.mutable.get=n.mutable.get.bind(n.mutable),r.event.subscribe=n.event.subscribe.bind(n.event),r.event.unsubscribe=n.event.unsubscribe.bind(n.event),this.storeQueue.push({store:n,callbacks:t}),r}},o.Dispatcher=s,t.exports=o},{"./mutable-store":4,"./queue":5}],2:[function(e,t,n){function r(e,t,n){if(!(e instanceof Object))return e;var i,o=Object.prototype.toString.call(e).slice(8,-1);switch(o){case"Array":i=[];break;case"Date":i=new Date(e.getTime());break;case"RegExp":i=new RegExp(e);break;case"Function":break;case"Uint8Array":case"Uint8ClampedArray":case"Uint16Array":case"Uint32Array":case"Int8Array":case"Int16Array":case"Int32Array":case"Float32Array":case"Float64Array":i=e.subarray();break;default:i={}}if(t.push(e),n.push(i),e instanceof Array)for(var s=0;s<e.length;s++)i[s]=r(e[s],t,n);for(var a=Object.keys(e).sort(),u=Object.keys(i).sort(),c=0;c<a.length;c++){var f=a[c];if(u.length>0&&f===u[0])u.shift();else if(Object.prototype.hasOwnProperty.call(e,f)){var l=e[f],h=t.indexOf(l);i[f]=-1!==h?n[h]:r(e[f],t,n)}}return i}t.exports=function(e){return r(e,[],[])}},{}],3:[function(e,t,n){"use strict";var r=function(){this.handlers=[]};r.prototype={publish:function(e){this.handlers.forEach(function(t){t.type?t.type===e&&t.handler(e):t.handler(e)})},subscribe:function(e,t){var n={};"function"==typeof e?n.handler=e:(n.handler=t,n.type=e),this.handlers.push(n)},unsubscribe:function(e,t){"function"==typeof e&&(t=e,e=null);for(var n,r=0,i=!1;r<this.handlers.length;r++)n=this.handlers[r],n.type?e&&t?i=n.type===e&&n.handler===t:e?i=n.type===e:t&&(i=n.handler===t):i=n.handler===t,i&&this.handlers.splice(r--,1)}},t.exports=r},{}],4:[function(e,t,n){"use strict";var r=e("./copy"),i=e("./event"),o={string:!0,number:!0,"null":!0,undefind:!0,"boolean":!0},s=function(e){this.store={},Object.keys(e).forEach(function(t){this.store[t]=e[t]}.bind(this))};s.prototype={set:function(e,t){return e in this.store?(this.store[e]=t,e):void 0},get:function(e){var t=this.store[e],n=typeof t;return o[n]?t:r(t)},"delete":function(e){return delete this.store[e],e}};var a=function(e){this.mutable=new s(e),this.event=new i};t.exports=a},{"./copy":2,"./event":3}],5:[function(e,t,n){"use strict";var r=function(e,t){this.workflows=[],this.completeCallback=e,t&&(this._workflows=[])};r.prototype={enter:function(e){this.workflows.push(e),this._workflows&&this._workflows.push(e)},execute:function(e,t){t=t||this.workflows.concat();var n;t.length?(n=t.shift())(e,this.execute.bind(this,e,t)):(this._workflows&&(this.workflows=this._workflows.concat()),t=null,this.completeCallback(e))}},t.exports=r},{}]},{},[1])(1)});